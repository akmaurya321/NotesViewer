<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Notes Viewer — HTML / GIF / MP4 / Lottie</title>

  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa6bf;--accent:#7dd3fc}
    *{box-sizing:border-box}
    body{
      margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background:linear-gradient(180deg,#071029,#071320);
      color:#e6eef8;min-height:100vh;
    }
    .wrap{max-width:1100px;margin:28px auto;padding:20px}
    .btn{
      background:rgba(255,255,255,0.08);
      border:1px solid rgba(255,255,255,0.18);
      padding:8px 14px;border-radius:14px;
      color:#e8f3ff;cursor:pointer;transition:.25s;
      box-shadow:0 4px 14px rgba(0,0,0,0.25);
    }
    .btn:hover{background:rgba(255,255,255,0.12);transform:translateY(-1px)}
    .input{
      background:transparent;border:1px solid rgba(255,255,255,0.06);
      padding:8px 12px;border-radius:10px;color:inherit;min-width:260px;
    }
    .viewer{
      background:#061122;
      min-height:100vh;height:100vh;
      display:flex;align-items:center;justify-content:center;
      overflow:auto;border-radius:6px;
    }
    iframe,video,img,.lottie-container{
      width:100%;height:100%;border:0;border-radius:8px;
    }
  </style>

</head>
<body>
<div class="wrap">

  <!-- HEADER -->
  <header style="display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:10px">
    <h1 style="margin:0;font-size:22px">Notes Viewer</h1>

    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <button class="btn" onclick="location.href='/NotesViewer/pages/mynotes.html'">My Notes</button>
      <button class="btn" onclick="location.href='/NotesViewer/pages/upload.html'">  Upload & Share </button>

      <button id="downloadUnified" class="btn">⬇️ Download</button>
      <button id="openNew" class="btn">Open in new tab</button>
      <button id="copyUrl" class="btn">Copy URL</button>
      <button id="linkedinShare" class="btn">LinkedIn</button>
      <button id="toggleBorder" class="btn">Padding</button>
    </div>
  </header>

  <!-- INPUT -->
  <div style="display:flex;gap:10px; margin-bottom:20px">
    <input id="fileInput" class="input" placeholder="Enter path or URL e.g. notes/user/file.html" style="flex:1">
    <button id="loadBtn" class="btn">Load</button>
  </div>

  <!-- VIEWER -->
  <section class="viewer" id="viewer">
    <div id="placeholder" style="text-align:center;opacity:0.9">
      <div>No file loaded.</div>
      <div style="font-size:13px;color:var(--muted)">Paste a path or URL and click Load.</div>
    </div>
  </section>

</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.10.2/lottie.min.js"></script>

<script>
/* -------- READ FROM ?file= -------- */
function getQueryFile(){
  const url = new URL(window.location.href);
  return url.searchParams.get("file") || "";
}

/* -------- DOM -------- */
const viewer = document.getElementById("viewer");
const placeholder = document.getElementById("placeholder");
const fileInput = document.getElementById("fileInput");
const loadBtn = document.getElementById("loadBtn");
const downloadBtn = document.getElementById("downloadUnified");
const openNew = document.getElementById("openNew");
const copyUrl = document.getElementById("copyUrl");
const linkedinShare = document.getElementById("linkedinShare");
const toggleBorder = document.getElementById("toggleBorder");

/* -------- MAIN LOAD -------- */
function loadFile(path){
  placeholder?.remove();
  viewer.innerHTML = "";

  const resolved = resolvePath(path);
  const ext = (path.split(".").pop() || "").toLowerCase();

  if(ext === "html" || ext === "htm") renderIframe(resolved);
  else if(["mp4","webm","mov"].includes(ext)) renderVideo(resolved);
  else if(["png","jpg","jpeg","gif","apng"].includes(ext)) renderImage(resolved);
  else renderIframe(resolved);
}

/* -------- PATH RESOLVER -------- */
function resolvePath(input){
  if(/^https?:\/\//.test(input)) return input;  
  if(input.startsWith("/")) return location.origin + input;

  const base = location.href.split("?")[0];
  const folder = base.substring(0, base.lastIndexOf("/") + 1);
  return folder + input;
}

/* -------- RENDERING -------- */
function renderIframe(src){
  const f = document.createElement("iframe"); f.src = src;
  viewer.appendChild(f);
}
function renderVideo(src){
  const v = document.createElement("video");
  v.controls = true; v.src = src;
  viewer.appendChild(v);
}
function renderImage(src){
  const img = document.createElement("img");
  img.src = src;
  viewer.appendChild(img);
}

/* -------- EVENTS -------- */
loadBtn.onclick = () => {
  if(fileInput.value.trim()) loadFile(fileInput.value.trim());
};

openNew.onclick = () => {
  if(!fileInput.value) return;
  const u = buildLink(fileInput.value.trim());
  window.open(u, "_blank");
};

copyUrl.onclick = () => {
  if(!fileInput.value) return;
  const u = buildLink(fileInput.value.trim());
  navigator.clipboard.writeText(u);
  copyUrl.textContent = "Copied!";
  setTimeout(()=>copyUrl.textContent="Copy URL", 1000);
};

linkedinShare.onclick = () => {
  if(!fileInput.value) return;
  const u = encodeURIComponent(buildLink(fileInput.value.trim()));
  window.open("https://www.linkedin.com/sharing/share-offsite/?url=" + u, "_blank");
};

toggleBorder.onclick = () => {
  viewer.style.padding = viewer.style.padding ? "" : "20px";
};

/* -------- DOWNLOAD FIX -------- */
downloadBtn.onclick = async () => {
  if(!fileInput.value) return alert("No file loaded");

  const url = resolvePath(fileInput.value.trim());
  const name = fileInput.value.trim().split("/").pop();

  const blob = await fetch(url).then(r=>r.blob());
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = name;
  a.click();
};

/* -------- CORRECT SHARE URL -------- */
function buildLink(fileUrl){
  return location.origin + "/NotesViewer/index.html?file=" + encodeURIComponent(fileUrl);
}

/* -------- AUTO LOAD -------- */
const initial = getQueryFile();
if(initial){
  fileInput.value = initial;
  loadFile(initial);
}
</script>

</body>
</html>
